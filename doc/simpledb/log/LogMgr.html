<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (version 1.7.0_02) on Sat Feb 04 21:12:06 EST 2012 -->
<title>LogMgr</title>
<meta name="date" content="2012-02-04">
<link rel="stylesheet" type="text/css" href="../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="LogMgr";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/LogMgr.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../index-files/index-1.html">Index</a></li>
<li><a href="../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../simpledb/log/LogIterator.html" title="class in simpledb.log"><span class="strong">Prev Class</span></a></li>
<li>Next Class</li>
</ul>
<ul class="navList">
<li><a href="../../index.html?simpledb/log/LogMgr.html" target="_top">Frames</a></li>
<li><a href="LogMgr.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field_summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field_detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">simpledb.log</div>
<h2 title="Class LogMgr" class="title">Class LogMgr</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>simpledb.log.LogMgr</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Implemented Interfaces:</dt>
<dd>java.lang.Iterable&lt;<a href="../../simpledb/log/BasicLogRecord.html" title="class in simpledb.log">BasicLogRecord</a>&gt;</dd>
</dl>
<hr>
<br>
<pre>public class <span class="strong">LogMgr</span>
extends java.lang.Object
implements java.lang.Iterable&lt;<a href="../../simpledb/log/BasicLogRecord.html" title="class in simpledb.log">BasicLogRecord</a>&gt;</pre>
<div class="block">The low-level log manager.
 This log manager is responsible for writing log records
 into a log file.
 A log record can be any sequence of integer and string values.
 The log manager does not understand the meaning of these
 values, which are written and read by the
 <a href="../../simpledb/tx/recovery/RecoveryMgr.html" title="class in simpledb.tx.recovery"><code>recovery manager</code></a>.</div>
<dl><dt><span class="strong">Author:</span></dt>
  <dd>Edward Sciore</dd></dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field_summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Field Summary table, listing fields, and an explanation">
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Field and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private <a href="../../simpledb/file/Block.html" title="class in simpledb.file">Block</a></code></td>
<td class="colLast"><code><strong><a href="../../simpledb/log/LogMgr.html#currentblk">currentblk</a></strong></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private int</code></td>
<td class="colLast"><code><strong><a href="../../simpledb/log/LogMgr.html#currentpos">currentpos</a></strong></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static int</code></td>
<td class="colLast"><code><strong><a href="../../simpledb/log/LogMgr.html#LAST_POS">LAST_POS</a></strong></code>
<div class="block">The location where the pointer to the last integer in the page is.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private java.lang.String</code></td>
<td class="colLast"><code><strong><a href="../../simpledb/log/LogMgr.html#logfile">logfile</a></strong></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private <a href="../../simpledb/file/Page.html" title="class in simpledb.file">Page</a></code></td>
<td class="colLast"><code><strong><a href="../../simpledb/log/LogMgr.html#mypage">mypage</a></strong></code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><strong><a href="../../simpledb/log/LogMgr.html#LogMgr(java.lang.String)">LogMgr</a></strong>(java.lang.String&nbsp;logfile)</code>
<div class="block">Creates the manager for the specified log file.</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>int</code></td>
<td class="colLast"><code><strong><a href="../../simpledb/log/LogMgr.html#append(java.lang.Object[])">append</a></strong>(java.lang.Object[]&nbsp;rec)</code>
<div class="block">Appends a log record to the file.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private void</code></td>
<td class="colLast"><code><strong><a href="../../simpledb/log/LogMgr.html#appendNewBlock()">appendNewBlock</a></strong>()</code>
<div class="block">Clear the current page, and append it to the log file.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private void</code></td>
<td class="colLast"><code><strong><a href="../../simpledb/log/LogMgr.html#appendVal(java.lang.Object)">appendVal</a></strong>(java.lang.Object&nbsp;val)</code>
<div class="block">Adds the specified value to the page at the position denoted by
 currentpos.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private int</code></td>
<td class="colLast"><code><strong><a href="../../simpledb/log/LogMgr.html#currentLSN()">currentLSN</a></strong>()</code>
<div class="block">Returns the LSN of the most recent log record.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private void</code></td>
<td class="colLast"><code><strong><a href="../../simpledb/log/LogMgr.html#finalizeRecord()">finalizeRecord</a></strong>()</code>
<div class="block">Sets up a circular chain of pointers to the records in the page.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private void</code></td>
<td class="colLast"><code><strong><a href="../../simpledb/log/LogMgr.html#flush()">flush</a></strong>()</code>
<div class="block">Writes the current page to the log file.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../simpledb/log/LogMgr.html#flush(int)">flush</a></strong>(int&nbsp;lsn)</code>
<div class="block">Ensures that the log records corresponding to the
 specified LSN has been written to disk.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private int</code></td>
<td class="colLast"><code><strong><a href="../../simpledb/log/LogMgr.html#getLastRecordPosition()">getLastRecordPosition</a></strong>()</code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>java.util.Iterator&lt;<a href="../../simpledb/log/BasicLogRecord.html" title="class in simpledb.log">BasicLogRecord</a>&gt;</code></td>
<td class="colLast"><code><strong><a href="../../simpledb/log/LogMgr.html#iterator()">iterator</a></strong>()</code>
<div class="block">Returns an iterator for the log records,
 which will be returned in reverse order starting with the most recent.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private void</code></td>
<td class="colLast"><code><strong><a href="../../simpledb/log/LogMgr.html#setLastRecordPosition(int)">setLastRecordPosition</a></strong>(int&nbsp;pos)</code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private int</code></td>
<td class="colLast"><code><strong><a href="../../simpledb/log/LogMgr.html#size(java.lang.Object)">size</a></strong>(java.lang.Object&nbsp;val)</code>
<div class="block">Calculates the size of the specified integer or string.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<ul class="blockList">
<li class="blockList"><a name="field_detail">
<!--   -->
</a>
<h3>Field Detail</h3>
<a name="LAST_POS">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>LAST_POS</h4>
<pre>public static final&nbsp;int LAST_POS</pre>
<div class="block">The location where the pointer to the last integer in the page is.
 A value of 0 means that the pointer is the first value in the page.</div>
<dl><dt><span class="strong">See Also:</span></dt><dd><a href="../../constant-values.html#simpledb.log.LogMgr.LAST_POS">Constant Field Values</a></dd></dl>
</li>
</ul>
<a name="logfile">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>logfile</h4>
<pre>private&nbsp;java.lang.String logfile</pre>
</li>
</ul>
<a name="mypage">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>mypage</h4>
<pre>private&nbsp;<a href="../../simpledb/file/Page.html" title="class in simpledb.file">Page</a> mypage</pre>
</li>
</ul>
<a name="currentblk">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>currentblk</h4>
<pre>private&nbsp;<a href="../../simpledb/file/Block.html" title="class in simpledb.file">Block</a> currentblk</pre>
</li>
</ul>
<a name="currentpos">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>currentpos</h4>
<pre>private&nbsp;int currentpos</pre>
</li>
</ul>
</li>
</ul>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="LogMgr(java.lang.String)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>LogMgr</h4>
<pre>public&nbsp;LogMgr(java.lang.String&nbsp;logfile)</pre>
<div class="block">Creates the manager for the specified log file.
 If the log file does not yet exist, it is created
 with an empty first block.
 This constructor depends on a <a href="../../simpledb/file/FileMgr.html" title="class in simpledb.file"><code>FileMgr</code></a> object
 that it gets from the method
 <a href="../../simpledb/server/SimpleDB.html#fileMgr()"><code>SimpleDB.fileMgr()</code></a>.
 That object is created during system initialization.
 Thus this constructor cannot be called until
 <a href="../../simpledb/server/SimpleDB.html#initFileMgr(java.lang.String)"><code>SimpleDB.initFileMgr(String)</code></a>
 is called first.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>logfile</code> - the name of the log file</dd></dl>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="flush(int)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>flush</h4>
<pre>public&nbsp;void&nbsp;flush(int&nbsp;lsn)</pre>
<div class="block">Ensures that the log records corresponding to the
 specified LSN has been written to disk.
 All earlier log records will also be written to disk.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>lsn</code> - the LSN of a log record</dd></dl>
</li>
</ul>
<a name="iterator()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>iterator</h4>
<pre>public&nbsp;java.util.Iterator&lt;<a href="../../simpledb/log/BasicLogRecord.html" title="class in simpledb.log">BasicLogRecord</a>&gt;&nbsp;iterator()</pre>
<div class="block">Returns an iterator for the log records,
 which will be returned in reverse order starting with the most recent.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code>iterator</code>&nbsp;in interface&nbsp;<code>java.lang.Iterable&lt;<a href="../../simpledb/log/BasicLogRecord.html" title="class in simpledb.log">BasicLogRecord</a>&gt;</code></dd>
<dt><span class="strong">See Also:</span></dt><dd><code>Iterable.iterator()</code></dd></dl>
</li>
</ul>
<a name="append(java.lang.Object[])">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>append</h4>
<pre>public&nbsp;int&nbsp;append(java.lang.Object[]&nbsp;rec)</pre>
<div class="block">Appends a log record to the file.
 The record contains an arbitrary array of strings and integers.
 The method also writes an integer to the end of each log record whose value
 is the offset of the corresponding integer for the previous log record.
 These integers allow log records to be read in reverse order.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>rec</code> - the list of values</dd>
<dt><span class="strong">Returns:</span></dt><dd>the LSN of the final value</dd></dl>
</li>
</ul>
<a name="appendVal(java.lang.Object)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>appendVal</h4>
<pre>private&nbsp;void&nbsp;appendVal(java.lang.Object&nbsp;val)</pre>
<div class="block">Adds the specified value to the page at the position denoted by
 currentpos.  Then increments currentpos by the size of the value.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>val</code> - the integer or string to be added to the page</dd></dl>
</li>
</ul>
<a name="size(java.lang.Object)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>size</h4>
<pre>private&nbsp;int&nbsp;size(java.lang.Object&nbsp;val)</pre>
<div class="block">Calculates the size of the specified integer or string.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>val</code> - the value</dd>
<dt><span class="strong">Returns:</span></dt><dd>the size of the value, in bytes</dd></dl>
</li>
</ul>
<a name="currentLSN()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>currentLSN</h4>
<pre>private&nbsp;int&nbsp;currentLSN()</pre>
<div class="block">Returns the LSN of the most recent log record.
 As implemented, the LSN is the block number where the record is stored.
 Thus every log record in a block has the same LSN.</div>
<dl><dt><span class="strong">Returns:</span></dt><dd>the LSN of the most recent log record</dd></dl>
</li>
</ul>
<a name="flush()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>flush</h4>
<pre>private&nbsp;void&nbsp;flush()</pre>
<div class="block">Writes the current page to the log file.</div>
</li>
</ul>
<a name="appendNewBlock()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>appendNewBlock</h4>
<pre>private&nbsp;void&nbsp;appendNewBlock()</pre>
<div class="block">Clear the current page, and append it to the log file.</div>
</li>
</ul>
<a name="finalizeRecord()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>finalizeRecord</h4>
<pre>private&nbsp;void&nbsp;finalizeRecord()</pre>
<div class="block">Sets up a circular chain of pointers to the records in the page.
 There is an integer added to the end of each log record
 whose value is the offset of the previous log record.
 The first four bytes of the page contain an integer whose value
 is the offset of the integer for the last log record in the page.</div>
</li>
</ul>
<a name="getLastRecordPosition()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getLastRecordPosition</h4>
<pre>private&nbsp;int&nbsp;getLastRecordPosition()</pre>
</li>
</ul>
<a name="setLastRecordPosition(int)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>setLastRecordPosition</h4>
<pre>private&nbsp;void&nbsp;setLastRecordPosition(int&nbsp;pos)</pre>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/LogMgr.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../index-files/index-1.html">Index</a></li>
<li><a href="../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../simpledb/log/LogIterator.html" title="class in simpledb.log"><span class="strong">Prev Class</span></a></li>
<li>Next Class</li>
</ul>
<ul class="navList">
<li><a href="../../index.html?simpledb/log/LogMgr.html" target="_top">Frames</a></li>
<li><a href="LogMgr.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field_summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field_detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
